# Feature 003: Excel å…¬å¼åŒ¯å…¥èˆ‡è½‰æ›

## ðŸ“– åŠŸèƒ½ç°¡ä»‹

å°‡ Excel æª”æ¡ˆåŒ¯å…¥ Grist æ™‚ï¼Œè‡ªå‹•æª¢æ¸¬ä¸¦è½‰æ› Excel å…¬å¼ç‚º Grist å…¬å¼ï¼Œç„¡éœ€æ‰‹å‹•é‡å»ºã€‚

## ðŸŽ¯ æ ¸å¿ƒåƒ¹å€¼

- **ç¯€çœæ™‚é–“**: è‡ªå‹•è½‰æ›å…¬å¼ï¼Œæ¸›å°‘ 90% çš„æ‰‹å‹•è¼¸å…¥å·¥ä½œ
- **é™ä½ŽéŒ¯èª¤**: é¿å…æ‰‹å‹•è¼¸å…¥å…¬å¼æ™‚çš„éŒ¯èª¤
- **å¹³æ»‘é·ç§»**: è®“ Excel ç”¨æˆ¶æ›´å®¹æ˜“é·ç§»åˆ° Grist

## âœ¨ ä¸»è¦åŠŸèƒ½

### 1. è‡ªå‹•å…¬å¼æª¢æ¸¬
æ ¹æ“šç¬¬ä¸€å€‹æ•¸æ“šè¡Œè‡ªå‹•åˆ¤æ–·å“ªäº›æ¬„ä½åŒ…å«å…¬å¼

```
Excel æª”æ¡ˆ:
Row 1: Name    | Price | Qty | Total
Row 2: Item A  | 100   | 5   | =B2*C2  â† æª¢æ¸¬åˆ°å…¬å¼
Row 3: Item B  | 200   | 3   | =B3*C3

çµæžœ: Total æ¬„ä½è¢«è­˜åˆ¥ç‚ºå…¬å¼æ¬„ä½
```

### 2. Cell Reference è½‰æ›
å°‡ Excel çš„ cell reference è½‰æ›ç‚º Grist çš„ column reference

| Excel èªžæ³• | Grist èªžæ³• | èªªæ˜Ž |
|-----------|-----------|------|
| `=B2*C2` | `$Price * $Quantity` | ç›¸å° reference |
| `=SUM(A2:A10)` | `SUM(Table1.Name)` | ç¯„åœ reference |
| `=IF(B2>100, C2*0.9, C2)` | `IF($Price > 100, $Quantity * 0.9, $Quantity)` | æ¢ä»¶å‡½æ•¸ |

### 3. è½‰æ›å ±å‘Š
åŒ¯å…¥å®Œæˆå¾Œé¡¯ç¤ºè©³ç´°çš„è½‰æ›å ±å‘Š

```
Excel åŒ¯å…¥å ±å‘Š
================
âœ“ æˆåŠŸè½‰æ›: 3 å€‹å…¬å¼æ¬„ä½
âš  éœ€è¦æª¢æŸ¥: 1 å€‹æ¬„ä½
âœ— è½‰æ›å¤±æ•—: 0 å€‹æ¬„ä½

è©³ç´°:
âœ“ Total: =B2*C2 â†’ $Price * $Quantity
âœ“ Discount: =IF(B2>100, B2*0.9, B2) â†’ IF($Price > 100, $Price * 0.9, $Price)
âœ“ Average: =AVERAGE(B:B) â†’ AVERAGE(Table1.Price)
```

## ðŸ“¦ å¯¦ä½œéšŽæ®µ

### Phase 1: åŸºæœ¬è½‰æ›ï¼ˆæœ¬éšŽæ®µï¼‰
**æ™‚ç¨‹**: 7-8 é€±

**åŒ…å«åŠŸèƒ½**:
- âœ… è®€å– Excel å…¬å¼
- âœ… æª¢æ¸¬å…¬å¼æ¬„ä½
- âœ… è½‰æ›ç°¡å–® cell references (`A2`, `$B$5`)
- âœ… è½‰æ›ç¯„åœ references (`A2:A10`, `B:B`)
- âœ… æ”¯æ´åŸºæœ¬å‡½æ•¸ (SUM, AVERAGE, IF, MAX, MIN)
- âœ… éŒ¯èª¤è™•ç†å’Œè½‰æ›å ±å‘Š

**æ”¯æ´çš„å…¬å¼é¡žåž‹**:
```excel
âœ… ç®—è¡“é‹ç®—: =A2+B2, =B2*C2
âœ… çµ±è¨ˆå‡½æ•¸: =SUM(A2:A10), =AVERAGE(B:B)
âœ… æ¢ä»¶å‡½æ•¸: =IF(A2>100, B2, C2)
âœ… é‚è¼¯å‡½æ•¸: =AND(A2>0, B2<100)
```

**ä¸æ”¯æ´ï¼ˆç•™å¾… Phase 2ï¼‰**:
```excel
âŒ VLOOKUP, HLOOKUP
âŒ SUMIFS, COUNTIFS
âŒ è·¨ sheet references (Sheet2!A1)
âŒ é™£åˆ—å…¬å¼
âŒ å‘½åç¯„åœ
```

### Phase 2: é€²éšŽå‡½æ•¸ï¼ˆè¦åŠƒä¸­ï¼‰
**æ™‚ç¨‹**: TBD

- è¤‡é›œå‡½æ•¸è½‰æ› (VLOOKUP â†’ Lookup columns)
- è·¨ sheet references
- æ¢ä»¶èšåˆå‡½æ•¸ (SUMIFS, COUNTIFS)

### Phase 3: å®Œæ•´ç›¸å®¹ï¼ˆæœªä¾†ï¼‰
**æ™‚ç¨‹**: TBD

- é™£åˆ—å…¬å¼
- å‹•æ…‹é™£åˆ—
- å‘½åç¯„åœ
- å·¨é›†å’Œ VBAï¼ˆè€ƒæ…®ä¸­ï¼‰

## ðŸš€ ä½¿ç”¨æ–¹å¼

### 1. åŒ¯å…¥ Excel æª”æ¡ˆ
```
1. é»žæ“Šã€ŒAdd Newã€â†’ã€ŒImport from Excelã€
2. é¸æ“‡è¦åŒ¯å…¥çš„ Excel æª”æ¡ˆ
3. ç¢ºèªã€ŒAuto-convert Excel formulasã€é¸é …å·²å‹¾é¸
```

### 2. æª¢è¦–é è¦½
```
ç³»çµ±æœƒé¡¯ç¤º:
- æª”æ¡ˆçµæ§‹é è¦½
- æª¢æ¸¬åˆ°çš„å…¬å¼æ¬„ä½æ•¸é‡
- æ¬„ä½é¡žåž‹å’Œæ ¼å¼
```

### 3. åŸ·è¡ŒåŒ¯å…¥
```
1. é»žæ“Šã€ŒImportã€æŒ‰éˆ•
2. ç­‰å¾…è½‰æ›å®Œæˆï¼ˆé€šå¸¸ < 5 ç§’ï¼‰
3. æŸ¥çœ‹è½‰æ›å ±å‘Š
```

### 4. é©—è­‰çµæžœ
```
åŒ¯å…¥å¾Œ:
- æª¢æŸ¥å…¬å¼æ¬„ä½çš„è¨ˆç®—çµæžœ
- ç¢ºèªæ•¸å€¼èˆ‡ Excel ä¸€è‡´
- å¦‚æœ‰è­¦å‘Šï¼Œæª¢è¦–ä¸¦æ‰‹å‹•èª¿æ•´
```

## ðŸ“‹ ç¯„ä¾‹å ´æ™¯

### ç¯„ä¾‹ 1: éŠ·å”®å ±è¡¨
```excel
Excel è¼¸å…¥:
A        | B      | C        | D
Product  | Price  | Quantity | Total
Item A   | 100    | 5        | =B2*C2
Item B   | 200    | 3        | =B3*C3

Grist çµæžœ:
- Total æ¬„ä½è‡ªå‹•è¨­å®šç‚º: $Price * $Quantity
- è¨ˆç®—çµæžœ: 500, 600
```

### ç¯„ä¾‹ 2: æŠ˜æ‰£è¨ˆç®—
```excel
Excel è¼¸å…¥:
A        | B      | C           | D
Product  | Price  | Is_Premium  | Final_Price
Item A   | 100    | TRUE        | =IF(C2, B2*0.9, B2)
Item B   | 200    | FALSE       | =IF(C3, B3*0.9, B3)

Grist çµæžœ:
- Final_Price æ¬„ä½è‡ªå‹•è¨­å®šç‚º: IF($Is_Premium, $Price * 0.9, $Price)
- è¨ˆç®—çµæžœ: 90, 200
```

### ç¯„ä¾‹ 3: çµ±è¨ˆåˆ†æž
```excel
Excel è¼¸å…¥:
A          | B        | C       | D          | E
Month      | Sales    | Total   | Average    | Max
Jan        | 1000     | =SUM($B$2:$B$13) | =AVERAGE(B:B) | =MAX(B:B)
Feb        | 1200     | =SUM($B$2:$B$13) | =AVERAGE(B:B) | =MAX(B:B)

Grist çµæžœ:
- Total: SUM(Table1.Sales)
- Average: AVERAGE(Table1.Sales)
- Max: MAX(Table1.Sales)
```

## ðŸ”§ æŠ€è¡“æž¶æ§‹

```
ä½¿ç”¨è€… â†’ Importer UI â†’ ExcelFormulaParser
                           â†“
                   CellReferenceConverter
                           â†“
                   FormulaConverter
                           â†“
                   Grist API â†’ ActiveDoc
```

### æ ¸å¿ƒçµ„ä»¶

1. **ExcelFormulaParser**: è®€å– Excel å…¬å¼
2. **CellReferenceConverter**: è½‰æ› cell references
3. **FormulaConverter**: è½‰æ›å®Œæ•´å…¬å¼
4. **ConversionReport**: é¡¯ç¤ºè½‰æ›çµæžœ

## âš ï¸ é™åˆ¶èˆ‡æ³¨æ„äº‹é …

### ç›®å‰é™åˆ¶ (Phase 1)
- âŒ ä¸æ”¯æ´ VLOOKUP, HLOOKUP ç­‰æŸ¥æ‰¾å‡½æ•¸
- âŒ ä¸æ”¯æ´è·¨ sheet references
- âŒ ä¸æ”¯æ´é™£åˆ—å…¬å¼
- âŒ ä¸æ”¯æ´å‘½åç¯„åœ

### èªžç¾©å·®ç•°
```
Excel: cell-based references
- A2 æŒ‡å‘ row 2, column A çš„ç‰¹å®š cell

Grist: column-based references
- $ColumnA æŒ‡å‘ç•¶å‰ row çš„ ColumnA æ¬„ä½

å½±éŸ¿:
æŸäº›ä¾è³´ç‰¹å®š row çš„ Excel å…¬å¼å¯èƒ½éœ€è¦èª¿æ•´
```

### æœ€ä½³å¯¦è¸
1. **åŒ¯å…¥å‰å‚™ä»½**: å…ˆåœ¨ Grist ä¸­æ¸¬è©¦å°ç¯„åœæ•¸æ“š
2. **æª¢æŸ¥å ±å‘Š**: ä»”ç´°æŸ¥çœ‹è½‰æ›å ±å‘Šä¸­çš„è­¦å‘Š
3. **é©—è­‰çµæžœ**: æ¯”å° Grist å’Œ Excel çš„è¨ˆç®—çµæžœ
4. **æ‰‹å‹•èª¿æ•´**: å°è½‰æ›å¤±æ•—çš„å…¬å¼æ‰‹å‹•è¨­å®š

## ðŸ§ª æ¸¬è©¦æ•¸æ“š

æˆ‘å€‘æä¾›äº†æ¸¬è©¦ç”¨çš„ Excel æª”æ¡ˆï¼š

```
test/fixtures/excel-formulas/
â”œâ”€â”€ simple-formulas.xlsx       # ç°¡å–®ç®—è¡“å…¬å¼
â”œâ”€â”€ statistical-functions.xlsx # çµ±è¨ˆå‡½æ•¸ (SUM, AVERAGE)
â”œâ”€â”€ conditional-formulas.xlsx  # æ¢ä»¶å‡½æ•¸ (IF, AND, OR)
â”œâ”€â”€ mixed-references.xlsx      # æ··åˆ reference é¡žåž‹
â””â”€â”€ edge-cases.xlsx           # é‚Šç•Œæƒ…æ³æ¸¬è©¦
```

## ðŸ“š ç›¸é—œæ–‡ä»¶

- [éœ€æ±‚è¦æ ¼](./spec.md) - å®Œæ•´çš„åŠŸèƒ½éœ€æ±‚
- [å¯¦ä½œè¨ˆåŠƒ](./implementation-plan.md) - è©³ç´°çš„å¯¦ä½œæ­¥é©Ÿ
- [API æ–‡ä»¶](./api.md) - é–‹ç™¼è€… API åƒè€ƒï¼ˆå¾…å»ºç«‹ï¼‰
- [æ•…éšœæŽ’é™¤](./troubleshooting.md) - å¸¸è¦‹å•é¡Œè§£æ±ºï¼ˆå¾…å»ºç«‹ï¼‰

## ðŸ› å·²çŸ¥å•é¡Œ

### Issue #1: è¤‡é›œç¯„åœé‹ç®—
**å•é¡Œ**: å¸¶æœ‰å¤šå€‹æ¢ä»¶çš„ç¯„åœå…¬å¼å¯èƒ½ç„¡æ³•æ­£ç¢ºè½‰æ›
```excel
=SUMIFS(B:B, A:A, ">100", C:C, "<50")  â† ç›®å‰ä¸æ”¯æ´
```
**è§£æ±ºæ–¹æ¡ˆ**: Phase 2 å°‡æ”¯æ´ï¼Œç›®å‰è«‹æ‰‹å‹•è¨­å®š

### Issue #2: è·¨ Sheet References
**å•é¡Œ**: å¼•ç”¨å…¶ä»– sheet çš„å…¬å¼ç„¡æ³•è‡ªå‹•è½‰æ›
```excel
=Sheet2!A1  â† ç›®å‰ä¸æ”¯æ´
```
**è§£æ±ºæ–¹æ¡ˆ**: Phase 2 å°‡æ˜ å°„åˆ° Grist çš„ reference columns

## ðŸ’¬ åé¥‹èˆ‡æ”¯æ´

- **åŠŸèƒ½å»ºè­°**: åœ¨ GitHub Issues æå‡º
- **Bug å›žå ±**: ä½¿ç”¨ Bug Report æ¨¡æ¿
- **æŠ€è¡“æ”¯æ´**: è¯ç¹«é–‹ç™¼åœ˜éšŠ

## ðŸŽ¯ æœªä¾†è¦åŠƒ

### çŸ­æœŸ (3-6 å€‹æœˆ)
- [ ] æ”¯æ´ VLOOKUP/HLOOKUP
- [ ] æ”¯æ´ SUMIFS/COUNTIFS
- [ ] æ”¹å–„éŒ¯èª¤è¨Šæ¯

### ä¸­æœŸ (6-12 å€‹æœˆ)
- [ ] è·¨ sheet references
- [ ] å‘½åç¯„åœæ”¯æ´
- [ ] é™£åˆ—å…¬å¼

### é•·æœŸ (12+ å€‹æœˆ)
- [ ] Excel â†” Grist é›™å‘åŒæ­¥
- [ ] å…¬å¼å„ªåŒ–å»ºè­°
- [ ] AI è¼”åŠ©å…¬å¼è½‰æ›

## ðŸ“Š æˆåŠŸæŒ‡æ¨™

**ç›®æ¨™**:
- è½‰æ›æˆåŠŸçŽ‡ â‰¥ 80%
- è¨ˆç®—æº–ç¢ºçŽ‡ â‰¥ 95%
- ä½¿ç”¨è€…æ»¿æ„åº¦ â‰¥ 4/5
- åŒ¯å…¥æ™‚é–“ < 5 ç§’ (1000 rows)

**è¿½è¹¤**:
- æ¯é€±è½‰æ›æˆåŠŸçŽ‡å ±å‘Š
- ä½¿ç”¨è€…åé¥‹æ”¶é›†
- æ•ˆèƒ½ç›£æŽ§

---

**åŠŸèƒ½ç‹€æ…‹**: ðŸ“‹ è¦åŠƒä¸­
**é è¨ˆç™¼å¸ƒ**: Phase 1 é è¨ˆ 8-10 é€±
**å„ªå…ˆç´š**: P1 (é«˜)
**è² è²¬åœ˜éšŠ**: [å¾…æŒ‡å®š]

**æœ€å¾Œæ›´æ–°**: 2025-11-18
